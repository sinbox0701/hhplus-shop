# 캐시 전략

## 1. 상품 정보 조회 캐싱

### 대상 메서드

- `ProductFacade.getAllProductsWithOptions()` - 모든 상품과 옵션 조회
- `ProductFacade.getProductWithOptions()` - 개별 상품과 옵션 조회
- `ProductFacade.getTopSellingProducts()` - 인기 상품 조회

### 적용 이유

- 상품 정보는 조회 빈도가 매우 높음
- 데이터 변경이 비교적 드물게 발생
- 상품 조회는 전체 시스템 부하의 큰 부분을 차지
- 사용자 경험과 직결되는 핵심 기능

### 캐싱 전략

- **캐시 계층**: Local(L1) + Redis(L2)
- **캐싱 패턴**: Cache-Aside
- **TTL 설정**:
  - 일반 상품 정보: 60분
  - 인기 상품 목록: 15분
- **무효화 전략**: 상품 수정/삭제 시 명시적 캐시 무효화

## 2. 인기 상품/추천 상품 데이터

### 대상 메서드

- `ProductSalesAggregationFacade.aggregateDailySales()` 결과 데이터

### 적용 이유

- 집계 쿼리는 DB 부하가 크고 계산 비용이 높음
- 실시간 갱신이 필수적이지 않음
- 다수 사용자가 동일한 결과를 조회

### 캐싱 전략

- **캐시 계층**: Redis(L2)
- **캐싱 패턴**: Refresh-Ahead
- **TTL 설정**: 15분
- **갱신 전략**: 일정 시간마다 백그라운드에서 비동기 갱신

## 3. 사용자 설정/공통 정보

### 대상 메서드

- `UserAccountFacade.findUserWithAccount()` - 사용자 기본 정보 조회

### 적용 이유

- 로그인 후 자주 접근하지만 변경이 적은 정보
- 사용자별 개인화된 정보로 반복 조회 발생
- 조회 성능이 사용자 경험에 영향

### 캐싱 전략

- **캐시 계층**: Redis(L2)
- **캐싱 패턴**: Cache-Aside
- **TTL 설정**: 30분
- **무효화 전략**: 사용자 정보 또는 계좌 정보 변경 시 캐시 무효화

## 4. 쿠폰 정보 조회

### 대상 메서드

- `CouponFacade.findByUserId()` - 사용자별 쿠폰 목록 조회
- `CouponFacade.findByUserIdAndCouponId()` - 특정 쿠폰 정보 조회

### 적용 이유

- 장바구니나 결제 과정에서 반복 조회 발생
- 쿠폰 발급/사용 시에만 변경되는 데이터
- 쿠폰 목록 조회는 여러 테이블 조인 필요

### 캐싱 전략

- **캐시 계층**: Redis(L2)
- **캐싱 패턴**: Cache-Aside
- **TTL 설정**: 20분
- **무효화 전략**: 쿠폰 발급, 사용, 삭제 시 관련 캐시 무효화

## 5. 주문 처리 중 읽기 작업

### 대상 메서드

- `OrderFacade.createOrder()` 내부의 상품/옵션 조회
- `OrderFacade.processPayment()` 내부의 일부 읽기 작업

### 적용 이유

- 주문 생성 과정에서 동일 상품/옵션 정보 반복 조회 발생
- 트랜잭션 내에서 읽기 일관성 보장 필요
- 분산 락과 함께 사용 시 시스템 안정성 향상

### 캐싱 전략

- **캐시 계층**: Local(L1)
- **캐싱 패턴**: Cache-Aside + Write-Through
- **TTL 설정**: 10분 (짧은 TTL 적용)
- **특별 고려사항**: 재고 정보는 항상 최신 데이터 조회 필요

## 구현 시 고려사항

1. **캐시 키 설계**

   - 적절한 프리픽스 사용으로 관리 용이성 확보
   - 키 충돌 방지와 효율적인 무효화를 위한 키 구조 설계

2. **캐시 직렬화/역직렬화**

   - 효율적인 직렬화 방식 선택 (JSON, Protocol Buffers 등)
   - 캐시 적중률 향상을 위한 메모리 최적화

3. **캐시 모니터링**

   - 캐시 히트율, 미스율 모니터링
   - 메모리 사용량 및 캐시 성능 추적

4. **장애 대응**
   - 캐시 장애 시 우아한 성능 저하 전략 수립
   - Circuit Breaker 패턴 적용 고려
